<?xml version="1.0" encoding="UTF-8"?>
<configuration debug="false" scan="true" scanPeriod="1 seconds">
    <include resource="org/springframework/boot/logging/logback/base.xml"/>
    <!-- <jmxConfigurator/> -->
    <contextName>logback</contextName>

    <property name="log.path" value="./logback.log"/>

    <property name="log.pattern"
              value="%d{yyyy-MM-dd HH:mm:ss.SSS} -%5p ${PID} --- [%15.15t] %-40.40logger{39} : %m%n"/>


    <!--<appender name="file" class="ch.qos.logback.core.rolling.RollingFileAppender">-->
    <!--<file>${log.path}</file>-->

    <!--<encoder>-->
        <!--<pattern>${log.pattern}</pattern>-->
    <!--</encoder>-->

    <!--<rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">-->

    <!--<fileNamePattern>info-%d{yyyy-MM-dd}-%i.log-->
    <!--</fileNamePattern>-->

    <!--<timeBasedFileNamingAndTriggeringPolicy-->
    <!--class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">-->

    <!--<maxFileSize>10MB</maxFileSize>-->
    <!--</timeBasedFileNamingAndTriggeringPolicy>-->
    <!--<maxHistory>10</maxHistory>-->
    <!--</rollingPolicy>-->

    <!--</appender>-->

    <!--<appender name="socket"-->
    <!--class="net.logstash.logback.appender.LogstashSocketAppender">-->
    <!--<filter class="ch.qos.logback.classic.filter.ThresholdFilter">-->
    <!--<level>INFO</level>-->
    <!--</filter>-->
    <!--<host>192.168.9.7</host>-->
    <!--<port>5044</port>-->
    <!--<customFields>{"appname":"myapp"}</customFields>-->
    <!--</appender>-->

    <!-- 上传到那个服务器接口 -->
    <appender name="api-logstash" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
        <destination>192.168.9.7:5044</destination>
        <!-- encoder必须配置,有多种可选 -->
        <encoder charset="UTF-8" class="net.logstash.logback.encoder.LogstashEncoder">
            <customFields>{"appname":"spring-boot"}</customFields>
        </encoder>
        <keepAliveDuration>5 minutes</keepAliveDuration>
    </appender>

    <!-- 异步写入日志 -->
    <appender name="api-async" class="ch.qos.logback.classic.AsyncAppender">
        <appender-ref ref="api-logstash"/>
        <queueSize>1</queueSize>
        <discardingThreshold>1</discardingThreshold>
    </appender>

    <root>
        <appender-ref ref="api-async"/>
    </root>

</configuration>